from sys import argv
import numpy as np
# Used to smooth the images and remove the usignificant objects
from scipy import ndimage
from skimage.io import imread, imsave
import os

def bindImage(*argv):
    # Open multiple images and bind them all
    k = 0
    blur_radius = 0.15
    threshold = 50
    exported_img = np.zeros((imread(argv[1]).shape[0], imread(argv[1]).shape[1], len(argv)))
    print exported_img.shape
    while(k < len(argv)):
        img = imread(argv[k])
        imgf = ndimage.gaussian_filter(img, blur_radius)
        labeled, nr_objects = ndimage.label(imgf > threshold)
        print labeled.shape
        exported_img[:,:,k] = labeled[:,:]
        print "image "+str(k+1)+" contains "+str(nr_objects)+" objects."
        k+=1
        print "Your image have been exported to:"+str(os.path.dirname(os.path.realpath(__file__)))+ "binded_and_labled_image.tiff"
    imsave("binded_and_labled_image.tiff", exported_img[:,:,:], plugin="tifffile")

def main():
    print "/////////////////****************//////////////"
    print argv[1:]
    bindImage(*argv[1:])

if __name__ == "__main__":
    main()
